
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../API-M%201.8.0/1.9.0/1.9.1/1.10.0%20to%202.0.0/">
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.29">
    
    
      
        <title>Upgrading from the Previous Release - WSO2 APIM Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.76a95c52.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="grey" data-md-color-accent="purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#upgrading-from-the-previous-release" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="WSO2 APIM Documentation" class="md-header__button md-logo" aria-label="WSO2 APIM Documentation" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            WSO2 APIM Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Upgrading from the Previous Release
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="grey" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="lime"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Documentation

      </a>
    </li>
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../API-M%201.8.0/1.9.0/1.9.1/1.10.0%20to%202.0.0/" class="md-tabs__link">
          
  
  API M 1.8.0

        </a>
      </li>
    
  

    
  

    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="./" class="md-tabs__link">
          
  
  API M 2.0.0

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="WSO2 APIM Documentation" class="md-nav__button md-logo" aria-label="WSO2 APIM Documentation" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    WSO2 APIM Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Documentation
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    API M 1.8.0
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            API M 1.8.0
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    1.9.0
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            1.9.0
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1_1" id="__nav_2_1_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    1.9.1
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_1">
            <span class="md-nav__icon md-icon"></span>
            1.9.1
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../API-M%201.8.0/1.9.0/1.9.1/1.10.0%20to%202.0.0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Upgrading from the Previous Release
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    API M 2.0.0
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            API M 2.0.0
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Upgrading from the Previous Release
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Upgrading from the Previous Release
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#migrating-the-configurations" class="md-nav__link">
    <span class="md-ellipsis">
      Migrating the configurations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#upgrading-the-api-manager-to-200" class="md-nav__link">
    <span class="md-ellipsis">
      Upgrading the API Manager to 2.0.0
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-migration-of-statistics-from-wso2-das-to-api-manager-analytics" class="md-nav__link">
    <span class="md-ellipsis">
      Data migration of statistics from WSO2 DAS to API Manager Analytics
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#migrating-the-configurations" class="md-nav__link">
    <span class="md-ellipsis">
      Migrating the configurations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#upgrading-the-api-manager-to-200" class="md-nav__link">
    <span class="md-ellipsis">
      Upgrading the API Manager to 2.0.0
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-migration-of-statistics-from-wso2-das-to-api-manager-analytics" class="md-nav__link">
    <span class="md-ellipsis">
      Data migration of statistics from WSO2 DAS to API Manager Analytics
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="upgrading-from-the-previous-release">Upgrading from the Previous Release</h1>
<p>The following information describes how to upgrade your API Manager
server <strong>from API-M 1.8.0/1.9.0/1.9.1/1.10.0</strong> <strong>to 2.0.0</strong>. </p>
<p>To upgrade <strong>from a version older than 1.8.0</strong>, follow the instructions
in the document that was released immediately after your current release
and upgrade incrementally.</p>
<ul>
<li>Migrating the configurations</li>
<li>Upgrading the API Manager to 2.0.0</li>
<li>Data migration of statistics from WSO2 DAS to API Manager Analytics</li>
</ul>
<h3 id="migrating-the-configurations">Migrating the configurations</h3>
<blockquote>
<p><strong>NOTE:</strong></p>
<p>Do not copy entire configuration files from the current version of API
Manager to the new one as some configuration files (for example,
<code>api-manager.xml</code>) may have changed. Instead, redo the configuration
changes in the new configuration files.</p>
</blockquote>
<p>In this section, you move all existing API Manager configurations from
the current environment to the new one.</p>
<ol>
<li>
<p>Back up all databases in your API Manager instances along with the
    synapse configs of all the tenants and super tenant.<br />
    You find the synapse configs of the super tenant in the
    <code>&lt;CURRENT_API-M_HOME&gt;/repository/deployment/server/synapse-configs/default</code>
    directory. Synapse configs of tenants are in
    the <code>&lt;CURRENT_API-M_HOME&gt;/repository/tenants</code> directory. <br />
    If you use a <strong>clustered/distributed API Manager setup</strong>, back up
    the available configurations in the API Gateway node.</p>
</li>
<li>
<p>Download API Manager 2.0.0
    from <a href="http://wso2.com/api-management/try-it/">http://wso2.com/products/api-manager/</a>.</p>
</li>
<li>
<p>Open
    the <code>&lt;API-M_2.0.0_HOME&gt;/repository/conf/datasources/master-datasources.xml</code> file
    and provide the datasource configurations for the following
    databases. You can copy the configuration values from the same file
    in the current API Manager instance already being used.</p>
<ul>
<li>User Store</li>
<li>Registry database/s</li>
<li>API Manager Databases</li>
</ul>
</li>
<li>
<p>Edit the registry configurations in
    the <code>&lt;API-M_2.0.0_HOME&gt;/repository/conf/registry.xml</code> file and the
    user database in
    the <code>&lt;API-M_2.0.0_HOME&gt;/repository/conf/user-mgt.xml</code> file similar
    to the configurations of the current API Manager.</p>
</li>
</ol>
<blockquote>
<p>Note that in a <strong>clustered/distributed API Manager setup</strong>, step 5
   and 6 need to be done on the Gateway node.</p>
</blockquote>
<ol>
<li>Move all your synapse configurations except the files mentioned
    below by copying and replacing
    the <code>&lt;CURRENT_API-M_HOME&gt;/repository/deployment/server/synapse-configs/default</code> directory
    to the
    <code>&lt;API-M_2.0.0_HOME&gt;/repository/deployment/server/synapse-configs/default</code>.<code></code></li>
</ol>
<blockquote>
<p><strong>NOTE:</strong> </p>
<p>Do not replace the files listed below from the
   <code>&lt;CURRENT_API-M_HOME&gt;/repository/deployment/server/synapse-configs/default</code>
   folder to APIM 2.0.0. These are application-specific APIs and
   sequences. If you made any custom changes to the files below, please
   merge them to the corresponding files in 2.0.0.</p>
<p><code>/api/_AuthorizeAPI_.xml</code> <code>/api/_RevokeAPI_.xml</code>
   <code>/api/_TokenAPI_.xml</code> <code>/api/_UserInfoAPI_.xml</code>
   <code>/sequences/_auth_failure_handler_.xml</code> <code>/sequences/_build_.xml</code>
   <code>/sequences/_cors_request_handler_.xml</code> <code>/sequences/fault.xml</code>
   <code>/sequences/main.xml</code> <code>/sequences/_production_key_error_.xml</code>
   <code>/sequences/_resource_mismatch_handler_.xml</code>
   <code>/sequences/_sandbox_key_error_.xml</code>
   <code>/sequences/_throttle_out_handler_.xml</code>
   <code>/sequences/_token_fault_.xml</code>
   <code>/proxy-services/WorkflowCallbackService.xml</code></p>
</blockquote>
<ol>
<li>Move all your tenant synapse configurations by updating the
    configurations made in the <code>&lt;CURRENT_API-M_HOME&gt;/repository/tenants</code>
    directory to the <code>&lt;API-M_2.0.0_HOME&gt;/repository/tenants</code> directory.</li>
</ol>
<blockquote>
<p><strong>NOTE:</strong> Get the files listed below from
   the <code>&lt;API-M_2.0.0_HOME&gt;/repository/deployment/server/synapse-configs/default/sequences</code>
   directory and replace the corresponding files in the
   <code>&lt;API-M_2.0.0_HOME&gt;/repository/tenants/&lt;tenant-id&gt;/synapse-configs/default/sequences</code>
   directory.</p>
<p><code>_auth_failure_handler_.xml</code> <code>_build_.xml</code>
   <code>_cors_request_handler_.xml</code> <code>fault.xml</code> <code>main.xml</code>
   <code>_production_key_error_.xml</code> <code>_resource_mismatch_handler_.xml</code>
   <code>_sandbox_key_error_.xml</code> <code>_throttle_out_handler_.xml</code>
   <code>_token_fault_.xml</code></p>
</blockquote>
<ol>
<li>If you have documentation defined for your APIs, make sure you add a
    value to the <strong>Documentation Summary</strong> field. <br />
    Documentation summary is mandatory in APIM 2.0 onwards. Trying to
    migrate with an empty documentation summary field from an older
    version can cause issues in the migration. </li>
</ol>
<h3 id="upgrading-the-api-manager-to-200">Upgrading the API Manager to 2.0.0</h3>
<ol>
<li>
<p>Stop all running API Manager server instances.</p>
</li>
<li>
<p>Make sure you backed up all the databases and synapse configs as
    instructed in step 1 of the previous section.</p>
</li>
<li>
<p>Before you run the migration client, open the
    <code>&lt;API-M_2.0.0_HOME&gt;/repository/conf/datasources/master-datasources.xml</code>
    file, and set the <code>&lt;username&gt;</code>, and <code>&lt;password&gt;</code> elements of
    the <code>AM_DB</code> JNDI to that of a user who has permissions to alter
    tables in the database.</p>
</li>
</ol>
<blockquote>
<p><strong>Tip</strong>: After you are done running the migration client, you can switch these credentials back to a user with lesser privileges.</p>
<p>For example,</p>
<p><code>java
   &lt;datasource&gt;
           ...
           &lt;definition type="RDBMS"&gt;
               &lt;configuration&gt;
                   ...
                   &lt;username&gt;xxxxxx&lt;/username&gt;
                   &lt;password&gt;xxxxxx&lt;/password&gt;
                   ...
               &lt;/configuration&gt;
            &lt;/definition&gt;
   &lt;/datasource&gt;</code></p>
</blockquote>
<ol>
<li>
<p>Download and extract the <code>wso2-api-migration-client.zip</code> and do the following:</p>
<ol>
<li>Copy the <code>org.wso2.carbon.apimgt.migrate.client-2.0.X.jar</code> file to
    the <code>&lt;API-M_2.0.0_HOME&gt;/repository/components/dropins</code> directory.
    If you use a <strong>clustered/distributed API Manager setup</strong>, copy
    the JAR file to a Publisher and a Gateway nodes.</li>
<li>
<p>Copy the <code>migration-script</code> folder into <code>&lt;API-M_2.0.0_HOME&gt;</code>. If
    you use a <strong>clustered/distributed API Manager setup</strong>, copy the
    <code>migration-script</code> folder to a Publisher node.</p>
<ol>
<li>
<p>Start API Manager 2.0.0 with the following command-line
    options to migrate the database, registry and the file
    system separately in the given order.</p>
<p><table>
<tbody>
<tr class="header">
<th>Command</th>
<th>Description</th>
</tr>
<tr class="odd">
<td ><code>-DmigrateDB=true -Dcomponent=apim -DmigrateFromVersion=&lt;CURRENT_API-M_VERSION&gt;</code></td>
<td >To migrate the database only. This migrates
the <code>AM_DB</code> database. Please ensure that the <code>&lt;API-M_PUBLISHER&gt;/repository/conf/datasources/master-datasources.xml</code>
file has an entry for <code>AM_DB</code>.</td>
</tr>
<tr class="even">
<td ><code>-DmigrateReg=true -Dcomponent=apim -DmigrateFromVersion=&lt;CURRENT_API-M_VERSION&gt;</code></td>
<td >To migrate the registry only.  This migrates
the registry-related resources such as <code>.rxt</code> and swagger
definitions.</td>
</tr>
<tr class="odd">
<td ><code>-DmigrateFS=true -Dcomponent=apim -DmigrateFromVersion=&lt;CURRENT_API-M_VERSION&gt;</code></td>
<td >To migrate the file system only.  This migrates
the synapse config files such as APIs that reside in the file system.
Therefore, you must run this command on the Gateway node/s of a
distributed API Manager setup.</td>
</tr>
<tr class="even">
&lt;td</p>
<blockquote>
<p><code>-Dcomponent=apim -DmigrateFromVersion=&lt;CURRENT_API-M_VERSION&gt; -Doptions=migrateThrottling</code></td>
<td >
<p>To migrate to the new throttling engine and generate throttle
policies.</p>
<p>This migrates synapse config files, the APIM database with new
throttle policies and generates throttle policies to the <code>&lt;API-M_HOME&gt;/executionplans</code>
directory. Therefore, you must run this command against a node that has
synapse config files and the AM_DB. After the migration, copy the <code>&lt;API-M_HOME&gt;/executionplans</code>
directory to the
<code>repository/deployment/server/executionplans</code> directory of
the Traffic Manager node.  </p>
<p>Note that you need to use either this command or the one below in
order to migrate to the <a href="https://docs.wso2.com/display/CLUSTER44x/Clustering+API+Manager+2.0.0">new
throttling engine of APIM 2.0.0</a>.</p>
</td>
</tr>
<tr class="odd">
&lt;td
<code>-Dcomponent=apim -DmigrateFromVersion=&lt;CURRENT_API-M_VERSION&gt; -Doptions=migrateThrottling,deployPolicies</code></td>
<td>
<p>To migrate to the new throttling engine and deploy throttle policies
to the <a href="https://docs.wso2.com/display/CLUSTER44x/Clustering+API+Manager+2.0.0">Traffic
Manager</a> node.</p>
<p>This migrates synapse config files, the APIM database with new
throttle policies and deploys policies to the Traffic Manager node.
Therefore, you must run this command against a node that has synapse
config files, the <code>AM_DB</code> and is pointed to the Traffic
Manager node.</p>
<p>Use this command if you want to deploy the throttle policies directly
to the Traffic Manager node while performing the migration.
<strong></strong></p>
</td>
</tr>
</tbody>
</table></p>
</blockquote>
</li>
</ol>
<blockquote>
<p><strong>TIP:</strong></p>
<p>If you are using a <strong>clustered/distributed API Manager
   setup</strong>, run with the following options
   <code>-DmigrateDB=true -DmigrateReg=true -Dcomponent=apim -DmigrateFromVersion=&lt;CURRENT_API-M_VERSION&gt;</code>
   in the API Publisher node and the
   <code>-DmigrateFS=true -Dcomponent=apim -DmigrateFromVersion=&lt;CURRENT_API-M_VERSION&gt;</code>
   options in the API Gateway node.</p>
<p><strong>TIP:</strong></p>
<p>To migrate to the new throttling engine of APIM 2.0.0, you
   have to use a node which has AM_DB pointed as well as API
   gateway synapse configurations in place in the file system.
   If you use only "migrateThrottling" option, you can use API
   Gateway node. Make sure that AM_DB is pointed to the gateway
   during the migration time. You can the start the gateway
   server with the
   <code>-Dcomponent=apim -DmigrateFromVersion=&lt;CURRENT_API-M_VERSION&gt; -Doptions=migrateThrottling</code>
   command. After completing this execution, make sure you copy
   the generated throttle policies in the
   <code>&lt;API-M_HOME&gt;/executionplans</code> directory to the
   <code>&lt;API-M_TRAFFIC_MANAGER&gt;/repository/deployment/server/executionplans</code>
   directory.</p>
<p><strong>NOTE:</strong></p>
<p>If you use both the <code>migrateThrottling,deployPolicies</code>
   options, make sure that the Traffic Manager node is
   configured with the Gateway node and also make sure you
   avoid passing the -Dprofile option while performing the
   migration. With these options, you don't have to manually
   copy the throttling policies to the traffic manager. You can
   the start the gateway server with
   <code>-Dcomponent=apim -DmigrateFromVersion=&lt;CURRENT_API-M_VERSION&gt; -Doptions=migrateThrottling,deployPolicies</code> command.  </p>
<p><strong>NOTE:</strong></p>
<p>If you have <a href="https://docs.wso2.com/display/AM200/Encrypting&gt;+OAuth+Keys">enabled token
   encryption</a>
   in your database, as part of database migration, those
   consumer keys need to be decrypted. If you see the error
   below, it means that the migration client has failed to
   decrypt some of the keys in the old database.</p>
<p><code>TID: [-1234] [] [2016-04-11 08:27:16,249] ERROR {org.wso2.carbon.apimgt.migration.client.MigrateFrom19to110} -  Cannot decrypt consumer key : DRHbt68uSU4+7xtCEIzuf42CMaqXbNjYl3OYVJ0VL/H6EsFo8GBRaZGUhLHlTWIHzYrvoeOpb1YbauvRRIN/b6VqEd9m8HuYOIuLkkDd AM_APPLICATION_KEY_MAPPING table {org.wso2.carbon.apimgt.migration.client.MigrateFrom19to110}</code></p>
<p>If this occurs, by default, the migration client will
   terminate without updating databases in order to maintain
   database integrity. However, you can change this behavior by
   adding the following argument and running the APIM migration
   client again from the beginning. <strong>Please note that the
   database is then updated with the keys
   where decryption was successful and failed keys
   are permanently deleted.</strong>
       <code>-DremoveDecryptionFailedKeysFromDB=true</code></p>
<p><strong>INFO:</strong></p>
<p>You may notice the following exception being thrown in the
   console when API Manager 2.0.0 is started at this point,</p>
<p><strong>org.wso2.carbon.idp.mgt.IdentityProviderManagementException:
   Error occurred while retrieving Identity Provider
   information for tenant : carbon.super and Identity Provider
   name : LOCAL</strong></p>
<p>This is due to the fact that the <code>IDP_METADATA</code> table does
   not exist in the API Manager database. This is not a cause
   for alarm and is to be expected since we are yet to complete
   the migration process. The instructions given from <strong>step
   9</strong> onwards will address the creation of the <code>IDP_METADATA</code>
   table after which this exception will no longer be thrown.</p>
</blockquote>
</li>
</ol>
</li>
<li>
<p>Do the following to re-index the artifacts in the registry:</p>
<ol>
<li>
<p>Rename the <code>&lt;lastAccessTimeLocation&gt;</code> element in
    the <code>&lt;API-M_2.0.0_HOME&gt;</code>/<code>repository/conf/registry.xml</code> file. If
    you use a <strong>clustered/distributed API Manager setup</strong>, change
    the file in the API Publisher node. For example, change
    the <code>/_system/local/repository/components/org.wso2.carbon.registry/indexing/lastaccesstime</code> registry
    path
    to <code>/_system/local/repository/components/org.wso2.carbon.registry/indexing/lastaccesstime_1</code><em><code>.</code></em><code></code></p>
</li>
<li>
<p>Shut down the API Manager 2.0.0, back up and delete the
    <code>&lt;API-M_2.0.0_HOME&gt;</code>/<code>solr</code> directory.</p>
</li>
</ol>
<blockquote>
<p>Steps 6,7 and 8 needs to be executed ONLY if the setup is migrating
from 1.8.0, 1.9.0 or 1.9.1. If the current setup is in 1.10.0, steps
6, 7 and 8 are NOT required to be executed.</p>
</blockquote>
</li>
<li>
<p>Execute the following update queries against the <code>WSO2AM_DB</code> to
    set the <code>GRANT_TYPE</code> column of the <code>IDN_OAUTH_CONSUMER_APPS</code> table:</p>
<p>``` java
UPDATE IDN_OAUTH_CONSUMER_APPS set GRANT_TYPES='refresh_token urn:ietf:params:oauth:grant-type:saml2-bearer implicit password iwa:ntlm client_credentials authorization_code' where CALLBACK_URL is not NULL; </p>
<p>UPDATE IDN_OAUTH_CONSUMER_APPS set GRANT_TYPES='refresh_token urn:ietf:params:oauth:grant-type:saml2-bearer password iwa:ntlm client_credentials' where CALLBACK_URL is NULL;<br />
```</p>
</li>
<li>
<p>Download the 
    <code>org.wso2.carbon.is.migrate.client-5.1.0-migration.zip</code> <strong>WSO2 Identity Server
    Migration Client</strong>. This is required to migrate the Identity and
    User Store Database schemas that is used by API Manager. Unzip the
    downloaded file to the local file system where
    the <code>wso2is-5.1.0-migration</code> directory is created and do the
    following:</p>
<blockquote>
<p><strong>INFO:</strong></p>
<p>If you are running in a distributed setup, ensure that this step is only carried out for the Key Manager node.</p>
<p>If you are running WSO2 Identity Server as a Key Manager in a distributed setup, first follow the instructions in <a href="https://docs.wso2.com/display/CLUSTER44x/Configuring+the+Identity+Server+5.2.0+as+a+Key+Manager+with+API+Manager+2.0.0">Configuring the
Identity Server 5.2.0 as a Key Manager with API Manager 2.0.0</a> before following the steps below. Make sure that the additional configurations you made in the following files for WSO2 Identity Server 5.1.0 are redone in the Identity Server 5.2.0 configuration files,</p>
<p><code>master-datasources.xml</code>, <code>registry.xml</code>, <code>user-mgt.xml</code>, <code>api-manager.xml</code></p>
</blockquote>
<p>a. Copy the
\&lt;<code>wso2is-5.1.0-migration&gt;/dbscripts/migration­5.0.0_to_5.1.0</code>
directory to the <code>&lt;``API-M_2.0.0_HOME``&gt;/dbscripts</code> directory.</p>
<blockquote>
<p>If you are using MySQL 5.7, carryout the following steps before proceeding to the next step.</p>
<ol>
<li>
<p>Navigate to the \&lt;<code>wso2is-5.1.0-migration&gt;/dbscripts/identity/migration­5.0.0SP1_to_5.1.0</code> directory.</p>
</li>
<li>
<p>Rename the <code>mysql.sql</code> file to <code>mysql_old.sql</code> or a name of your choice.</p>
</li>
<li>
<p>Rename the <code>mysql_57.sql</code> file to - <code>mysql.sql</code></p>
</li>
</ol>
</blockquote>
<p>b. Copy the \&lt;<code>wso2is-5.1.0-migration&gt;/</code>
<code>dbscripts/identity/migration­5.0.0SP1_to_5.1.0</code> directory and the
 \&lt;<code>wso2is-5.1.0-migration&gt;/</code>
<code>dbscripts/identity/migration­5.0.0_to_5.0.0SP1</code> directory to the
<code>&lt;``API-M_2.0.0_HOME``&gt;/dbscripts/identity</code> directory.<br />
      c. Copy the
\&lt;<code>wso2is-5.1.0-migration&gt;``/dropins/org.wso2.carbon.is.migrate.client-­5.1.0.jar</code>
file to
the <code>&lt;``API-M_2.0.0_HOME``&gt;/repository/components/dropins</code> directory.
   </p>
</li>
<li>
<p>Before executing identity migration as given in the step below,
    verify whether the API Manager database has the <code>IDN_ASSOCIATED_ID</code>
    table. To do that, connect to the API Manager database and check
    whether the <code>IDN_ASSOCIATED_ID</code> table exists. If not, download
    the <code>IDN-table.zip</code> file and run the relevant script according to your RDBMS against your API
    Manager DB.  </p>
</li>
<li>
<p>Start API Manager 2.0.0 with the command line
    option <code>-Dmigrate -Dcomponent=identity</code> to carry out the complete
    Identity and User Store DB migration. Alternatively, you can run it
    step by step by starting the server with the command line options
    given below in the following order. </p>
<ul>
<li><code>-Dmigrate -DmigrateIdentityDB -Dcomponent=identity</code></li>
<li><code>-Dmigrate -DmigrateUMDB -Dcomponent=identity</code></li>
<li><code>-Dmigrate -DmigrateIdentityData -Dcomponent=identity</code></li>
<li><code>-Dmigrate -DmigrateIdentityDBFinalize -Dcomponent=identity</code></li>
<li><code>-Dmigrate -DmigrateUMData -Dcomponent=identity</code>  </li>
</ul>
</li>
<li>
<p>Upgrading to IS 5.2.0 from 5.1.0</p>
<ol>
<li>
<p>Download 5.1.0 to 5.2.0 migration DB scripts
    <code>wso2is-5.2.0-migration.zip</code>.</p>
</li>
<li>
<p>Unzip and copy it to
    the <code>&lt;API-M_2.0.0_HOME&gt;/dbscripts/identity</code> directory.<br />
    Copying the DB scripts are optional as it is done for reference
    purposes to indicate the version to which you have upgraded your
    APIM IS component.</p>
</li>
<li>
<p>Execute the DB scripts, which corresponds to the RDBMS that you
    are working with, manually.</p>
<p>Apply the respective DB script that is inside the following
directories against the respective DB as follows:</p>
<p><table>
<tbody>
<tr>
<th>DB script directory</th>
<th>Applicable DB</th>
<th>Description</th>
</tr>
<tr class="odd">
&lt;td</p>
<blockquote>
<p><code>&lt;wso2is-5.2.0-migration&gt;/dbscripts/identity/migration-5.1.0_to_5.2.0 </code></td>
<td ><code>AM_DB</code></td>
<td ><br />
</td>
</tr>
<tr class="even">
&lt;td
<code>&lt;wso2is-5.2.0-migration&gt;/dbscripts/migration-5.1.0_to_5.2.0 </code></td>
<td ><code>UM_DB</code></td>
<td >This script includes insert operations and some
index creation scripts against the <code>UM_CLAIM</code> table which are
required in order for you to upgrade from your previous APIM version to
API-M 2.0.0.</td>
</tr>
</tbody>
</table></p>
</blockquote>
<p>For example, if you are working with a MySQL DB run
the <code>mysql.sql</code> script.</p>
</li>
</ol>
<blockquote>
<p>During the Identity and User Store DB migration, you may notice
warning messages similar to the following:</p>
<p><code>[2016-07-22 07:14:49,386] WARN - AppDeployerServiceComponent Waiting for required OSGi services: org.wso2.carbon.application.deployer.synapse.service.&gt;SynapseAppDeployerService,org.wso2.carbon.mediation.</code><br />
<code>initializer.services.SynapseEnvironmentService, [2016-07-22 07:14:49,418] WARN - StartupFinalizerServiceComponent Waiting for required OSGi services: org.&gt;wso2.carbon.application.deployer.service.CappDeploymentService,org.wso2.carbon.server.admin.</code><br />
<code>common.IServerAdmin,org.wso2.carbon.throttling.agent.ThrottlingAgent,</code></p>
<p><strong>Do not abort the migration process</strong> at this point as data
migration is still happening in the background and aborting could
result in data corruption. The time taken to finish depends on the
amount of tokens in the database and could take hours depending on
the amount of data.</p>
</blockquote>
</li>
</ol>
<p>This concludes the upgrade process.</p>
<blockquote>
<p><strong>Tip</strong>: </p>
<p>The migration client that you use in this guide automatically
migrates your tenants, workflows, external user stores etc. to the
upgrade environment. There is no need to migrate them manually.</p>
</blockquote>
<h3 id="data-migration-of-statistics-from-wso2-das-to-api-manager-analytics">Data migration of statistics from WSO2 DAS to API Manager Analytics</h3>
<p>From APIM 2.0.0 onwards, statistics can be configured only for RDBMS
since the API Manager 1.10.0 REST based analytics configuration no
longer exists. This section walks you through how to migrate statistics
data from previous versions of API Manager to 2.0.0. </p>
<p>If you have configured analytics using RDBMS,</p>
<ol>
<li>Download and extract the <code>wso2-api-stat-migration.zip</code> file. </li>
<li>Take a backup of the API Manager statistics DB. </li>
<li>Execute the relevant script in the
    <code>&lt;wso2-api-stat-migration&gt;/dbscripts</code> directory against your API
    Manager statistics DB. </li>
<li>Add the API Manager statistics DB as a datasource in WSO2 API
    Manager Analytics.</li>
</ol>
<p>If you configured analytics using the REST client in APIM 1.10.0 with
DAS 3.0.x,</p>
<ol>
<li>Configure analytics using API Manager 1.10.0 and DAS 3.0.x with the
    RDBMS client according to the instructions in <a href="https://docs.wso2.com/display/AM1100/Publishing+API+Runtime+Statistics+Using+RDBMS">Publishing API
    Runtime Statistics Using
    RDBMS</a>.</li>
<li>Wait for data to appear on the RDBMS and API Manager statistics
    dashboard.</li>
<li>Add the API Manager statistics DB as a datasource in WSO2 API
    Manager Analytics.</li>
</ol>
<p>Finally, execute relevant db script found in
the <code>migration-scripts/110-200-migration/stat/</code> directory on the
STAT_DB.</p>
<p>Once done, configure analytics in API Manager 2.0.0 according to the
instructions in <a href="https://docs.wso2.com/display/AM200/Configuring+APIM+Analytics">Configuring APIM
Analytics</a>.</p>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.sections", "navigation.top", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.copy"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.fe8b6f2b.min.js"></script>
      
    
  </body>
</html>